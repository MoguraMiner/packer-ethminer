{
  "variables": {
    "access_key": "{{env `access_key`}}",
    "secret_key": "{{env `secret_key`}}",
    "region": "{{env `region`}}",
    "instance_type": "{{env `instance_type`}}",
    "ssh_username": "{{env `ssh_username`}}"
  },
  "builders": [{
    "type": "amazon-ebs",
    "access_key": "{{user `access_key`}}",
    "secret_key": "{{user `secret_key`}}",
    "region": "{{user `region`}}",
    "source_ami": "ami-db123fcd",
    "instance_type": "{{user `instance_type`}}",
    "ssh_username": "ubuntu",
    "ami_name": "mogura-ethminer {{timestamp}}"
  }],
  "provisioners": [{
    "type": "shell",
    "inline": [
      "sleep 30",
      "sudo apt-get -y update",
      "sudo apt-get install wget",
      "wget -P /tmp http://us.download.nvidia.com/tesla/375.66/nvidia-diag-driver-local-repo-ubuntu1604_375.66-1_amd64.deb",
      "sudo dpkg -i /tmp/nvidia*.deb && rm /tmp/nvidia*.deb",
      "wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1-1_amd64.deb",
      "sudo dpkg -i /tmp/nvidia-docker*.deb && rm /tmp/nvidia-docker*.deb"
    ]
    }]
}
